import { useState } from 'react'

export function NotificationsPage() {
  const [filter, setFilter] = useState<'toutes' | 'non_lues'>('toutes')

  const notifications = [
    {
      id: '1',
      type: 'NOUVELLE_DEMANDE',
      titre: 'Nouvelle demande d\'analyse',
      message: 'Demande DA-20241129-0023 de SOCOCE',
      date: '2024-11-29 14:30',
      lue: false,
      priorite: 'NORMALE',
      icon: 'üìã',
      color: 'lanema-blue',
    },
    {
      id: '2',
      type: 'ESSAI_RETARD',
      titre: 'Essai en retard',
      message: 'ESS-20241126-0301 d√©passe la date d\'√©ch√©ance',
      date: '2024-11-29 10:15',
      lue: false,
      priorite: 'HAUTE',
      icon: '‚è∞',
      color: 'amber',
    },
    {
      id: '3',
      type: 'RESULTAT_DISPONIBLE',
      titre: 'R√©sultats disponibles',
      message: 'Les r√©sultats de l\'essai ESS-20241128-0423 sont pr√™ts',
      date: '2024-11-28 16:45',
      lue: true,
      priorite: 'NORMALE',
      icon: '‚úÖ',
      color: 'emerald',
    },
    {
      id: '4',
      type: 'NON_CONFORMITE',
      titre: 'Non-conformit√© d√©tect√©e',
      message: 'NC-2024-0091 - D√©rive de l\'√©talonnage de la balance',
      date: '2024-11-28 09:20',
      lue: false,
      priorite: 'CRITIQUE',
      icon: '‚ö†Ô∏è',
      color: 'rose',
    },
    {
      id: '5',
      type: 'STOCK_BAS',
      titre: 'Stock bas',
      message: 'Acide chlorhydrique 37% sous le seuil d\'alerte',
      date: '2024-11-27 14:00',
      lue: true,
      priorite: 'NORMALE',
      icon: 'üì¶',
      color: 'amber',
    },
    {
      id: '6',
      type: 'ETALONNAGE',
      titre: '√âtalonnage √† planifier',
      message: 'Balance de pr√©cision - √©talonnage dans 30 jours',
      date: '2024-11-27 08:30',
      lue: true,
      priorite: 'NORMALE',
      icon: 'üîß',
      color: 'violet',
    },
    {
      id: '7',
      type: 'PAIEMENT',
      titre: 'Paiement re√ßu',
      message: 'Facture FACT-2024-0156 pay√©e par SOCOCE',
      date: '2024-11-26 11:15',
      lue: true,
      priorite: 'BASSE',
      icon: 'üí∞',
      color: 'emerald',
    },
    {
      id: '8',
      type: 'RAPPORT_PRET',
      titre: 'Rapport pr√™t',
      message: 'Rapport RAP-2024-0301 valid√© et disponible',
      date: '2024-11-26 09:00',
      lue: true,
      priorite: 'NORMALE',
      icon: 'üìÑ',
      color: 'lanema-blue',
    },
    {
      id: '9',
      type: 'STOCK_RUPTURE',
      titre: 'Rupture de stock',
      message: 'Milieu de culture PCA en rupture de stock',
      date: '2024-11-25 15:45',
      lue: false,
      priorite: 'HAUTE',
      icon: 'üì¶',
      color: 'rose',
    },
    {
      id: '10',
      type: 'ESSAI_ATTRIBUE',
      titre: 'Essai attribu√©',
      message: 'Essai ESS-20241129-0045 vous a √©t√© attribu√©',
      date: '2024-11-25 13:20',
      lue: true,
      priorite: 'NORMALE',
      icon: 'üë§',
      color: 'lanema-blue',
    },
  ]

  const filteredNotifications = filter === 'non_lues'
    ? notifications.filter(n => !n.lue)
    : notifications

  const nonLuesCount = notifications.filter(n => !n.lue).length

  const prioriteBadgeColor = (priorite: string) => {
    const colors: Record<string, string> = {
      'CRITIQUE': 'bg-rose-100 text-rose-800 border-rose-200',
      'HAUTE': 'bg-amber-100 text-amber-800 border-amber-200',
      'NORMALE': 'bg-slate-100 text-slate-700 border-slate-200',
      'BASSE': 'bg-slate-50 text-slate-500 border-slate-100',
    }
    return colors[priorite] || 'bg-slate-100 text-slate-600 border-slate-200'
  }

  const marquerCommeLue = (id: string) => {
    // Logique pour marquer comme lue
    console.log('Marquer notification', id, 'comme lue')
  }

  const marquerToutesCommeLues = () => {
    // Logique pour tout marquer comme lu
    console.log('Marquer toutes les notifications comme lues')
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold text-slate-900">Notifications</h1>
          <p className="text-sm text-slate-600 mt-1">
            Centre de notifications et alertes ‚Ä¢ {nonLuesCount} non lue{nonLuesCount > 1 ? 's' : ''}
          </p>
        </div>
        <div className="flex items-center gap-2">
          <button
            onClick={marquerToutesCommeLues}
            className="inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 rounded-lg transition"
          >
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
            Tout marquer comme lu
          </button>
          <button className="inline-flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-200 hover:bg-slate-50 rounded-lg transition">
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Pr√©f√©rences
          </button>
        </div>
      </div>

      {/* Statistiques rapides */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div className="lanema-card p-4">
          <div className="text-xs text-slate-500 mb-1">Total</div>
          <div className="text-2xl font-semibold text-slate-900">{notifications.length}</div>
        </div>
        <div className="lanema-card p-4">
          <div className="text-xs text-slate-500 mb-1">Non lues</div>
          <div className="text-2xl font-semibold text-lanema-blue-600">{nonLuesCount}</div>
        </div>
        <div className="lanema-card p-4">
          <div className="text-xs text-slate-500 mb-1">Priorit√© haute</div>
          <div className="text-2xl font-semibold text-amber-600">
            {notifications.filter(n => n.priorite === 'HAUTE' || n.priorite === 'CRITIQUE').length}
          </div>
        </div>
        <div className="lanema-card p-4">
          <div className="text-xs text-slate-500 mb-1">Aujourd'hui</div>
          <div className="text-2xl font-semibold text-emerald-600">
            {notifications.filter(n => n.date.startsWith('2024-11-29')).length}
          </div>
        </div>
      </div>

      {/* Filtres */}
      <div className="lanema-card p-4">
        <div className="flex items-center gap-3">
          <button
            onClick={() => setFilter('toutes')}
            className={`px-4 py-2 text-sm font-medium rounded-lg transition ${
              filter === 'toutes'
                ? 'bg-lanema-blue-50 text-lanema-blue-700'
                : 'text-slate-600 hover:bg-slate-50'
            }`}
          >
            Toutes ({notifications.length})
          </button>
          <button
            onClick={() => setFilter('non_lues')}
            className={`px-4 py-2 text-sm font-medium rounded-lg transition ${
              filter === 'non_lues'
                ? 'bg-lanema-blue-50 text-lanema-blue-700'
                : 'text-slate-600 hover:bg-slate-50'
            }`}
          >
            Non lues ({nonLuesCount})
          </button>
        </div>
      </div>

      {/* Liste des notifications */}
      <div className="space-y-3">
        {filteredNotifications.map((notif) => (
          <div
            key={notif.id}
            className={`lanema-card p-5 cursor-pointer transition ${
              !notif.lue ? 'bg-lanema-blue-50/30 border-lanema-blue-100' : 'hover:bg-slate-50'
            }`}
            onClick={() => !notif.lue && marquerCommeLue(notif.id)}
          >
            <div className="flex items-start gap-4">
              {/* Ic√¥ne */}
              <div className={`w-12 h-12 rounded-lg bg-${notif.color}-50 flex items-center justify-center flex-shrink-0`}>
                <span className="text-2xl">{notif.icon}</span>
              </div>

              {/* Contenu */}
              <div className="flex-1 min-w-0">
                <div className="flex items-start justify-between gap-3 mb-1">
                  <div className="flex items-center gap-2">
                    <h3 className={`text-sm font-semibold ${!notif.lue ? 'text-slate-900' : 'text-slate-700'}`}>
                      {notif.titre}
                    </h3>
                    {!notif.lue && (
                      <span className="w-2 h-2 rounded-full bg-lanema-blue-600" />
                    )}
                  </div>
                  <span className={`inline-flex items-center px-2 py-0.5 text-xs font-medium rounded-full border flex-shrink-0 ${prioriteBadgeColor(notif.priorite)}`}>
                    {notif.priorite}
                  </span>
                </div>

                <p className="text-sm text-slate-600 mb-2">{notif.message}</p>

                <div className="flex items-center justify-between">
                  <span className="text-xs text-slate-500">{notif.date}</span>
                  <div className="flex items-center gap-2">
                    {!notif.lue && (
                      <button
                        onClick={(e) => {
                          e.stopPropagation()
                          marquerCommeLue(notif.id)
                        }}
                        className="text-xs text-lanema-blue-600 hover:text-lanema-blue-700 font-medium"
                      >
                        Marquer comme lue
                      </button>
                    )}
                    <button className="p-1 text-slate-400 hover:text-slate-600 rounded transition">
                      <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>

      {filteredNotifications.length === 0 && (
        <div className="lanema-card p-12 text-center">
          <div className="w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-4">
            <svg className="w-8 h-8 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
          </div>
          <h3 className="text-lg font-semibold text-slate-900 mb-1">Aucune notification</h3>
          <p className="text-sm text-slate-600">Vous n'avez aucune notification non lue pour le moment</p>
        </div>
      )}
    </div>
  )
}
